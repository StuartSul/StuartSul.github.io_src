<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work-Rest Interval Timer</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f0f0f0;
        font-family: Arial, sans-serif;
      }
      .title {
        font-size: 28px;
        font-weight: 700;
        text-align: center;
        margin-bottom: 20px;
        color: #333;
      }
      .timer-container {
        text-align: center;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .clock {
        font-size: 48px;
        margin-bottom: 20px;
      }
      .button {
        padding: 10px 20px;
        font-size: 18px;
        color: #fff;
        background-color: #007bff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.3s;
      }
      .button:hover {
        background-color: #0056b3;
        transform: scale(1.05);
      }
      .button:disabled {
        background-color: #6c757d;
        cursor: not-allowed;
      }
      .input-container {
        margin-top: 10px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        row-gap: 20px;
      }
      .input-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .input_fields {
        display: flex;
        align-items: center;
      }
      .input-field {
        width: 20px;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        text-align: center;
      }
      input[type=number]::-webkit-outer-spin-button,
      input[type=number]::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
      }
      input[type=number] {
          -moz-appearance: textfield;
      }
      .input-label {
        font-size: 16px;
      }
      .gap {
        width: 10px;
      }
      .flashing {
        animation: flash 0.75s infinite alternate;
      }
      @keyframes flash {
        0% { background-color: #daffda; }
        100% { background-color: #f0f0f0; }
      }
    </style>
</head>
<body>

  <div class="title">Work-Rest Interval Timer</div>
  <div class="container">
    <div class="timer-container">
      <div id="clock" class="clock"></div>
      <button id="button" class="button"></button>
    </div>
    <div class="input-container">
      <div class="input-box">
        <div class="input-fields">
          <input id="work-time-min" type="number" class="input-field" value="30">
          <span>:</span>
          <input id="work-time-sec" type="number" class="input-field" value="00">
        </div>
        <label for="work-time" class="input-label">Work Time</label>
      </div>
      <div class="gap"></div>
      <div class="input-box">
        <div class="input-fields">
          <input id="rest-time-min" type="number" class="input-field" value="30">
          <span>:</span>
          <input id="rest-time-sec" type="number" class="input-field" value="00">
        </div>
        <label for="rest-time" class="input-label">Rest Time</label>
      </div>
    </div>
  </div>

  <audio id="alarm-sound" src="alarm.mp3" preload="auto" loop></audio>

  <script>
    const initialState = 1;

    let clock = document.getElementById('clock');
    let button = document.getElementById('button');
    let alarmSound = document.getElementById('alarm-sound');
    let workTimeMinInput = document.getElementById('work-time-min');
    let workTimeSecInput = document.getElementById('work-time-sec');
    let restTimeMinInput = document.getElementById('rest-time-min');
    let restTimeSecInput = document.getElementById('rest-time-sec');

    let timeRemaining; // in seconds
    let timer;
    let state = initialState;

    function updateClock() {
      let minutes = Math.floor(timeRemaining / 60);
      let seconds = timeRemaining % 60;
      clock.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function startCountdown(duration, nextState) {
      clearInterval(timer);
      timeRemaining = duration;
      updateClock();

      timer = setInterval(() => {
        timeRemaining--;
        updateClock();
        if (timeRemaining <= 0) {
          clearInterval(timer);
          state = nextState;
          handleState();
        }
      }, 1000);
    }

    function getWorkTime() {
      return parseInt(workTimeMinInput.value) * 60 + parseInt(workTimeSecInput.value)
    }

    function getRestTime() {
      return parseInt(restTimeMinInput.value) * 60 + parseInt(restTimeSecInput.value)
    }

    function handleState() {
      switch (state) {
        case 1:
          timeRemaining = getWorkTime();
          updateClock();
          button.textContent = 'Begin Work';
          button.onclick = () => {
            state = 2;
            handleState();
          };
          break;
        case 2:
          button.textContent = 'Reset';
          button.onclick = () => {
            state = 1;
            clearInterval(timer);
            handleState();
          };
          startCountdown(getWorkTime(), 3);
          break;
        case 3:
          timeRemaining = getRestTime();
          updateClock();
          button.textContent = 'Begin Rest';
          alarmSound.play();
          document.body.classList.add('flashing')
          button.onclick = () => {
            state = 4;
            handleState();
            alarmSound.pause();
            alarmSound.currentTime = 0;
            document.body.classList.remove('flashing')
          };
          break;
        case 4:
          button.textContent = 'Reset';
          button.onclick = () => {
            state = 1;
            clearInterval(timer);
            handleState();
          };
          startCountdown(getRestTime(), 5);
          break;
        case 5:
          timeRemaining = 0;
          updateClock();
          button.textContent = 'Begin Work';
          alarmSound.play();
          document.body.classList.add('flashing')
          button.onclick = () => {
            state = 2;
            handleState();
            alarmSound.pause();
            alarmSound.currentTime = 0;
            document.body.classList.remove('flashing')
          };
          break;
      }
    }

    workTimeMinInput.oninput = () => {
      let correctedValue = Math.min(99, Math.max(0, workTimeMinInput.value));
      workTimeMinInput.value = correctedValue.toString().padStart(2, '0');
      if (state === 1) {
        timeRemaining = getWorkTime();
        updateClock();
      }
    };

    workTimeSecInput.oninput = () => {
      let correctedValue = Math.min(59, Math.max(0, workTimeSecInput.value));
      workTimeSecInput.value = correctedValue.toString().padStart(2, '0');
      if (state === 1) {
        timeRemaining = getWorkTime();
        updateClock();
      }
    };

    restTimeMinInput.oninput = () => {
      let correctedValue = Math.min(99, Math.max(0, restTimeMinInput.value));
      restTimeMinInput.value = correctedValue.toString().padStart(2, '0');
      if (state === 3) {
        timeRemaining = getRestTime();
        updateClock();
      }
    };

    restTimeSecInput.oninput = () => {
      let correctedValue = Math.min(59, Math.max(0, restTimeSecInput.value));
      restTimeSecInput.value = correctedValue.toString().padStart(2, '0');
      if (state === 3) {
        timeRemaining = getRestTime();
        updateClock();
      }
    };

    handleState();
  </script>

</body>
</html>
